<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModel="clr-namespace:GPlanner.Maui.ViewModels"
             x:Class="GPlanner.Maui.Pages.TasksPage"
             x:DataType="viewModel:TasksViewModel"
             Title="Tasks Page">

  <ContentPage.ToolbarItems>
    <ToolbarItem Text="Add"
                 IconImageSource="add.png"
                 Command="{Binding OpenTaskModalCommand}"/>
  </ContentPage.ToolbarItems>

  <Grid RowDefinitions="Auto,*"
        Padding="10"
        RowSpacing="10">

    <!-- Search -->
    <SearchBar Grid.Row="0"
               Placeholder="Search tasks..."
               Text="{Binding SearchText, Mode=TwoWay}"
               BackgroundColor="#F0F0F0"
               FontSize="16"
               TextColor="#202124"/>

    <!-- Tasks list -->
    <CollectionView Grid.Row="1"
                    ItemsSource="{Binding FilteredTasks}">
      <CollectionView.ItemTemplate>
        <DataTemplate x:DataType="viewModel:TaskItemViewModel">
          <SwipeView>
            <SwipeView.RightItems>
              <SwipeItems Mode="Reveal">
                <SwipeItem Text="Delete"
                           IconImageSource="delete.png"
                           BackgroundColor="#f44336"
                           Command="{Binding DeleteCommand}"/>
              </SwipeItems>
            </SwipeView.RightItems>

            <Frame CornerRadius="16"
                   HasShadow="True"
                   BorderColor="#E0E0E0"
                   BackgroundColor="White"
                   Padding="16,12"
                   Margin="0,4">

              <Grid RowDefinitions="Auto,Auto"
                    ColumnDefinitions="*,Auto">
                <!-- Title -->
                <Label Grid.Row="0"
                       Grid.Column="0"
                       Text="{Binding Title}"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="#202124"
                       VerticalOptions="Center"/>

                <!-- Edit button -->
                <ImageButton Grid.Row="0"
                             Grid.Column="1"
                             Source="edit.png"
                             BackgroundColor="Transparent"
                             WidthRequest="20"
                             HeightRequest="20"
                             Command="{Binding EditCommand}"
                             HorizontalOptions="End"
                             VerticalOptions="Center"
                             Padding="4"/>

                <!-- Meta info -->
                <StackLayout Grid.Row="1"
                             Grid.Column="0"
                             Grid.ColumnSpan="2"
                             Orientation="Horizontal"
                             Spacing="8"
                             Margin="0,6,0,0">
                  <Label Text="{Binding Date, StringFormat='{0:dd MMM yyyy HH:mm}'}"
                         FontSize="13"
                         TextColor="#777"/>
                  <Label Text="â€¢"
                         FontSize="13"
                         TextColor="#CCC"/>
                  <Label Text="{Binding Type}"
                         FontSize="13"
                         TextColor="#777"/>
                </StackLayout>
              </Grid>
            </Frame>
          </SwipeView>
        </DataTemplate>
      </CollectionView.ItemTemplate>
    </CollectionView>
  </Grid>
</ContentPage>
